name: Deploy Hugo to github.io

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"] # è§¦å‘æ„å»º
  workflow_dispatch:

env:
  HUGO_VERSION: latest
  TARGET_REPO: uzpeng/uzpeng.github.io # ğŸ‘ˆ æ›¿æ¢ä¸ºä½ çš„ç›®æ ‡ä»“åº“
  TARGET_BRANCH: master # æˆ– gh-pagesï¼Œå–å†³äºä½ åœ¨ç›®æ ‡ä»“åº“ Pages è®¾ç½®çš„æºåˆ†æ”¯

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Blog Source
        uses: actions/checkout@v4
        with:
          submodules: recursive  # æ‹‰å– Hugo ä¸»é¢˜å­æ¨¡å—
          fetch-depth: 0

      - name: Setup Hugo
        uses: peaceiris/actions-hugo@v2
        with:
          hugo-version: ${{ env.HUGO_VERSION }}
          extended: true

      - name: Build Hugo Site
        run: |
          hugo --minify --baseURL "https://${{ github.repository_owner }}.github.io/"

      - name: Deploy to github.io
        uses: peaceiris/actions-gh-pages@v4
        with:
          personal_token: ${{ secrets.TARGET_REPO_TOKEN }} # ğŸ‘ˆ ä½¿ç”¨ä½ æ·»åŠ çš„ Secret
          external_repository: ${{ env.TARGET_REPO }}     # ğŸ‘ˆ ç›®æ ‡ä»“åº“
          publish_branch: ${{ env.TARGET_BRANCH }}         # ğŸ‘ˆ ç›®æ ‡åˆ†æ”¯
          publish_dir: ./public                            # Hugo æ„å»ºè¾“å‡ºç›®å½•
          user_name: 'github-actions[bot]'
          user_email: 'github-actions[bot]@users.noreply.github.com'
          commit_message: 'Deploy Hugo site from Blog repo'
          full_commit_message: |
            Deploy Hugo site from Blog repo
            - Commit: ${{ github.sha }}
            - Workflow: ${{ github.workflow }}
